{% comment %}
  Ingredient Science Hub v4
  - Luxury/refined aesthetic with Bodoni Moda + Jost typography
  - Liquid glass design with gold accents
  - Fluid animations and elegant micro-interactions
  - Mobile: Horizontal carousel with peek effect
  - Desktop: Elegant grid layout
{% endcomment %}

<section
  class="ingredient-hub"
  id="ingredient-hub-{{ section.id }}"
  data-section-id="{{ section.id }}"
  data-card-count="{{ section.blocks.size }}"
>
  {%- comment -%} Decorative Background Elements {%- endcomment -%}
  <div class="ingredient-hub__bg">
    <div class="ingredient-hub__glow ingredient-hub__glow--1"></div>
    <div class="ingredient-hub__glow ingredient-hub__glow--2"></div>
  </div>

  <div class="ingredient-hub__container">
    <header class="ingredient-hub__header">
      {% if section.settings.title != blank %}
        <h2 class="ingredient-hub__title">{{ section.settings.title }}</h2>
      {% endif %}

      {% if section.settings.subtitle != blank %}
        <p class="ingredient-hub__subtitle">{{ section.settings.subtitle }}</p>
      {% endif %}

      <div class="ingredient-hub__divider">
        <span class="ingredient-hub__divider-line"></span>
        <svg class="ingredient-hub__divider-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <path d="M12 3L14.5 8.5L20.5 9.27L16.25 13.4L17.18 19.36L12 16.77L6.82 19.36L7.75 13.4L3.5 9.27L9.5 8.5L12 3Z" fill="currentColor"/>
        </svg>
        <span class="ingredient-hub__divider-line"></span>
      </div>
    </header>

    {% if section.blocks.size > 0 %}
      <div class="ingredient-hub__carousel">
        {% for block in section.blocks %}
          {% case block.type %}
            {% when 'ingredient' %}
              <article
                class="ingredient-card"
                data-block-id="{{ block.id }}"
                data-index="{{ forloop.index0 }}"
                {{ block.shopify_attributes }}
              >
                {%- comment -%} Floating Image Hero {%- endcomment -%}
                <div class="ingredient-card__hero">
                  {% if block.settings.image != blank %}
                    <div class="ingredient-card__image-container">
                      <div class="ingredient-card__image-glow"></div>
                      <img
                        src="{{ block.settings.image | image_url: width: 400 }}"
                        srcset="
                          {{ block.settings.image | image_url: width: 200 }} 200w,
                          {{ block.settings.image | image_url: width: 300 }} 300w,
                          {{ block.settings.image | image_url: width: 400 }} 400w
                        "
                        sizes="(max-width: 768px) 140px, 160px"
                        alt="{{ block.settings.name | escape }}"
                        class="ingredient-card__image"
                        loading="lazy"
                        width="160"
                        height="160"
                      >
                    </div>
                  {% endif %}

                  <div class="ingredient-card__identity">
                    <h3 class="ingredient-card__name">{{ block.settings.name }}</h3>
                    {% if block.settings.tagline != blank %}
                      <p class="ingredient-card__tagline">{{ block.settings.tagline }}</p>
                    {% endif %}
                  </div>
                </div>

                {%- comment -%} Elegant Tab Navigation {%- endcomment -%}
                <nav class="ingredient-card__tabs" role="tablist">
                  <button
                    class="ingredient-card__tab is-active"
                    role="tab"
                    aria-selected="true"
                    id="tab-benefits-{{ block.id }}"
                    aria-controls="panel-benefits-{{ block.id }}"
                    data-tab="benefits"
                    data-card="{{ block.id }}"
                  >
                    <span class="ingredient-card__tab-text">Faydalar</span>
                  </button>
                  <button
                    class="ingredient-card__tab"
                    role="tab"
                    aria-selected="false"
                    id="tab-articles-{{ block.id }}"
                    aria-controls="panel-articles-{{ block.id }}"
                    data-tab="articles"
                    data-card="{{ block.id }}"
                  >
                    <span class="ingredient-card__tab-text">Araştırmalar</span>
                  </button>
                  <button
                    class="ingredient-card__tab"
                    role="tab"
                    aria-selected="false"
                    id="tab-tests-{{ block.id }}"
                    aria-controls="panel-tests-{{ block.id }}"
                    data-tab="tests"
                    data-card="{{ block.id }}"
                  >
                    <span class="ingredient-card__tab-text">Laboratuvar</span>
                  </button>
                  <span class="ingredient-card__tab-indicator"></span>
                </nav>

                {%- comment -%} Content Panels {%- endcomment -%}
                <div class="ingredient-card__content">
                  {%- comment -%} Benefits Panel {%- endcomment -%}
                  <div
                    class="tab-panel is-active"
                    role="tabpanel"
                    id="panel-benefits-{{ block.id }}"
                    aria-labelledby="tab-benefits-{{ block.id }}"
                    data-panel="benefits"
                    data-card="{{ block.id }}"
                    tabindex="0"
                  >
                    <ul class="benefits-list">
                      {% assign benefits = block.settings.benefits | newline_to_br | split: '<br />' %}
                      {% for benefit in benefits %}
                        {% assign benefit_text = benefit | strip %}
                        {% if benefit_text != blank %}
                          <li class="benefit-item" style="--delay: {{ forloop.index | times: 0.08 }}s">
                            <span class="benefit-item__marker"></span>
                            <span class="benefit-item__text">{{ benefit_text }}</span>
                          </li>
                        {% endif %}
                      {% endfor %}
                    </ul>
                  </div>

                  {%- comment -%} Articles Panel {%- endcomment -%}
                  <div
                    class="tab-panel"
                    role="tabpanel"
                    id="panel-articles-{{ block.id }}"
                    aria-labelledby="tab-articles-{{ block.id }}"
                    data-panel="articles"
                    data-card="{{ block.id }}"
                    tabindex="0"
                  >
                    <div class="articles-list">
                      {% assign articles = block.settings.articles | newline_to_br | split: '<br />' %}
                      {% for article in articles %}
                        {% assign article_text = article | strip %}
                        {% if article_text != blank %}
                          {% assign article_parts = article_text | split: '|' %}
                          {% assign article_title = article_parts[0] | strip %}
                          {% assign article_source = article_parts[1] | strip %}
                          {% assign article_url = article_parts[2] | strip %}
                          <a
                            href="{{ article_url }}"
                            target="_blank"
                            rel="noopener noreferrer"
                            class="article-card"
                            style="--delay: {{ forloop.index | times: 0.1 }}s"
                          >
                            <div class="article-card__body">
                              <h4 class="article-card__title">{{ article_title }}</h4>
                              {% if article_source != blank %}
                                <span class="article-card__source">{{ article_source }}</span>
                              {% endif %}
                            </div>
                            <svg class="article-card__arrow" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" aria-hidden="true">
                              <path d="M7 17L17 7M17 7H7M17 7V17"/>
                            </svg>
                            <span class="visually-hidden">(yeni sekmede açılır)</span>
                          </a>
                        {% endif %}
                      {% endfor %}
                      {% if articles.size == 0 or block.settings.articles == blank %}
                        <p class="empty-state">Henüz araştırma eklenmedi.</p>
                      {% endif %}
                    </div>
                  </div>

                  {%- comment -%} Test Results Panel {%- endcomment -%}
                  <div
                    class="tab-panel"
                    role="tabpanel"
                    id="panel-tests-{{ block.id }}"
                    aria-labelledby="tab-tests-{{ block.id }}"
                    data-panel="tests"
                    data-card="{{ block.id }}"
                    tabindex="0"
                  >
                    <div class="test-results">
                      {% assign tests = block.settings.test_results | newline_to_br | split: '<br />' %}
                      {% for test in tests %}
                        {% assign test_text = test | strip %}
                        {% if test_text != blank %}
                          {% assign test_parts = test_text | split: '|' %}
                          {% assign test_name = test_parts[0] | strip %}
                          {% assign test_result = test_parts[1] | strip %}
                          {% assign test_percent = test_parts[2] | strip | default: '100' %}
                          {% assign test_range = test_parts[3] | strip %}

                          <div class="test-item" style="--delay: {{ forloop.index | times: 0.12 }}s">
                            <div class="test-item__header">
                              <span class="test-item__name">{{ test_name }}</span>
                              {% if test_result == 'GEÇTİ' or test_result == 'PASS' %}
                                <span class="test-item__badge test-item__badge--pass">
                                  <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" aria-hidden="true">
                                    <polyline points="20 6 9 17 4 12"/>
                                  </svg>
                                  GEÇTİ
                                </span>
                              {% else %}
                                <span class="test-item__badge">{{ test_result }}</span>
                              {% endif %}
                            </div>
                            <div class="test-item__bar">
                              <div class="test-item__progress" style="--progress: {{ test_percent }}%"></div>
                            </div>
                            <div class="test-item__footer">
                              <span class="test-item__percent">%{{ test_percent }}</span>
                              {% if test_range != blank %}
                                <span class="test-item__range">{{ test_range }}</span>
                              {% endif %}
                            </div>
                          </div>
                        {% endif %}
                      {% endfor %}

                      {%- comment -%} Certification {%- endcomment -%}
                      {% if block.settings.certification != blank or block.settings.test_date != blank %}
                        <div class="test-footer">
                          {% if block.settings.certification != blank %}
                            <div class="test-footer__item">
                              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" aria-hidden="true">
                                <circle cx="12" cy="8" r="6"/>
                                <path d="M8.21 13.89L7 21l5-3 5 3-1.21-7.11"/>
                              </svg>
                              <span>{{ block.settings.certification }}</span>
                            </div>
                          {% endif %}
                          {% if block.settings.test_date != blank %}
                            <div class="test-footer__item">
                              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" aria-hidden="true">
                                <rect x="3" y="4" width="18" height="18" rx="2"/>
                                <path d="M16 2v4M8 2v4M3 10h18"/>
                              </svg>
                              <span>{{ block.settings.test_date }}</span>
                            </div>
                          {% endif %}
                        </div>
                      {% endif %}
                    </div>
                  </div>
                </div>

                {%- comment -%} Card Footer {%- endcomment -%}
                <div class="ingredient-card__footer">
                  <span class="ingredient-card__note">Detaylı analiz için iletişime geçin</span>
                </div>
              </article>
          {% endcase %}
        {% endfor %}
      </div>

      {%- comment -%} Carousel Dots (Mobile Only) {%- endcomment -%}
      {% if section.blocks.size > 1 %}
        <div class="carousel-dots" aria-label="Carousel navigation">
          {% for block in section.blocks %}
            <button
              class="carousel-dot {% if forloop.first %}is-active{% endif %}"
              data-index="{{ forloop.index0 }}"
              aria-label="İçerik {{ forloop.index }} / {{ section.blocks.size }}"
            ></button>
          {% endfor %}
        </div>
      {% endif %}
    {% else %}
      <div class="ingredient-hub__empty">
        <p>İçerik düzenleyiciden içerik ekleyin.</p>
      </div>
    {% endif %}
  </div>
</section>

<style>
  /* ============================================
     INGREDIENT SCIENCE HUB v4
     Luxury/Refined Design with Liquid Glass
     ============================================ */

  /* Google Fonts */
  @import url('https://fonts.googleapis.com/css2?family=Bodoni+Moda:ital,wght@0,400;0,500;0,600;0,700;1,400&family=Jost:wght@300;400;500;600&display=swap');

  #ingredient-hub-{{ section.id }} {
    /* Premium Color Palette */
    --hub-black: #1C1917;
    --hub-black-soft: #292524;
    --hub-stone: #44403C;
    --hub-stone-light: #78716C;
    --hub-gold: #CA8A04;
    --hub-gold-light: rgba(202, 138, 4, 0.15);
    --hub-gold-glow: rgba(202, 138, 4, 0.4);
    --hub-cream: #FAFAF9;
    --hub-white: #FFFFFF;
    --hub-border: rgba(28, 25, 23, 0.08);
    --hub-border-subtle: rgba(28, 25, 23, 0.04);
    --hub-glass: rgba(255, 255, 255, 0.7);
    --hub-glass-border: rgba(255, 255, 255, 0.5);
    --hub-success: #15803D;
    --hub-success-light: rgba(21, 128, 61, 0.1);

    /* Typography */
    --font-display: 'Bodoni Moda', 'Playfair Display', Georgia, serif;
    --font-body: 'Jost', 'Inter', -apple-system, sans-serif;

    /* Spacing */
    --space-xs: 0.5rem;
    --space-sm: 0.75rem;
    --space-md: 1rem;
    --space-lg: 1.5rem;
    --space-xl: 2rem;
    --space-2xl: 3rem;

    /* Animation */
    --ease-out-expo: cubic-bezier(0.16, 1, 0.3, 1);
    --ease-out-back: cubic-bezier(0.34, 1.56, 0.64, 1);
    --duration-fast: 200ms;
    --duration-normal: 350ms;
    --duration-slow: 500ms;

    position: relative;
    padding: {{ section.settings.padding_top }}px 0 {{ section.settings.padding_bottom }}px;
    background: var(--hub-cream);
    font-family: var(--font-body);
    overflow: hidden;
  }

  /* ============================================
     DECORATIVE BACKGROUND
     ============================================ */

  .ingredient-hub__bg {
    position: absolute;
    inset: 0;
    pointer-events: none;
    overflow: hidden;
  }

  .ingredient-hub__glow {
    position: absolute;
    border-radius: 50%;
    filter: blur(80px);
    opacity: 0.5;
  }

  .ingredient-hub__glow--1 {
    width: 400px;
    height: 400px;
    background: var(--hub-gold-light);
    top: -100px;
    right: -100px;
  }

  .ingredient-hub__glow--2 {
    width: 300px;
    height: 300px;
    background: rgba(120, 113, 108, 0.1);
    bottom: -50px;
    left: -50px;
  }

  /* ============================================
     CONTAINER & HEADER
     ============================================ */

  .ingredient-hub__container {
    position: relative;
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 var(--space-md);
  }

  .ingredient-hub__header {
    text-align: center;
    margin-bottom: var(--space-2xl);
  }

  .ingredient-hub__title {
    font-family: var(--font-display);
    font-size: clamp(2rem, 5vw, 3.5rem);
    font-weight: 500;
    letter-spacing: -0.02em;
    line-height: 1.1;
    color: var(--hub-black);
    margin: 0 0 var(--space-sm);
  }

  .ingredient-hub__subtitle {
    font-family: var(--font-body);
    font-size: 1.125rem;
    font-weight: 300;
    color: var(--hub-stone);
    letter-spacing: 0.02em;
    margin: 0;
  }

  .ingredient-hub__divider {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: var(--space-md);
    margin-top: var(--space-lg);
  }

  .ingredient-hub__divider-line {
    width: 60px;
    height: 1px;
    background: linear-gradient(90deg, transparent, var(--hub-gold), transparent);
  }

  .ingredient-hub__divider-icon {
    color: var(--hub-gold);
    opacity: 0.8;
  }

  /* ============================================
     CAROUSEL
     ============================================ */

  .ingredient-hub__carousel {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(340px, 1fr));
    gap: var(--space-xl);
  }

  @media (max-width: 767px) {
    .ingredient-hub__container {
      padding: 0;
    }

    .ingredient-hub__header {
      padding: 0 var(--space-md);
    }

    .ingredient-hub__carousel {
      display: flex;
      align-items: flex-start;
      overflow-x: auto;
      scroll-snap-type: x mandatory;
      gap: var(--space-md);
      padding-left: calc(50vw - 150px);
      padding-right: calc(50vw - 150px);
      -webkit-overflow-scrolling: touch;
      scrollbar-width: none;
      touch-action: pan-x pinch-zoom;
    }

    .ingredient-hub__carousel::-webkit-scrollbar {
      display: none;
    }

    .ingredient-card {
      flex: 0 0 300px;
      scroll-snap-align: center;
      scroll-snap-stop: always;
    }

    .ingredient-card.is-clone {
      pointer-events: none;
    }
  }

  /* ============================================
     INGREDIENT CARD - Liquid Glass Design
     ============================================ */

  .ingredient-card {
    position: relative;
    background: var(--hub-glass);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border-radius: 24px;
    border: 1px solid var(--hub-glass-border);
    box-shadow:
      0 4px 24px rgba(28, 25, 23, 0.06),
      0 1px 2px rgba(28, 25, 23, 0.04),
      inset 0 1px 0 rgba(255, 255, 255, 0.6);
    overflow: hidden;
    transition:
      transform var(--duration-normal) var(--ease-out-expo),
      box-shadow var(--duration-normal) var(--ease-out-expo);
  }

  @supports not (backdrop-filter: blur(20px)) {
    .ingredient-card {
      background: rgba(255, 255, 255, 0.95);
    }
  }

  @media (min-width: 768px) {
    .ingredient-card:hover {
      transform: translateY(-8px);
      box-shadow:
        0 20px 40px rgba(28, 25, 23, 0.12),
        0 8px 16px rgba(28, 25, 23, 0.08),
        inset 0 1px 0 rgba(255, 255, 255, 0.8);
    }
  }

  /* ============================================
     CARD HERO - Floating Image
     ============================================ */

  .ingredient-card__hero {
    position: relative;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: var(--space-xl) var(--space-lg) var(--space-lg);
    text-align: center;
  }

  .ingredient-card__image-container {
    position: relative;
    width: 140px;
    height: 140px;
    margin-bottom: var(--space-md);
  }

  .ingredient-card__image-glow {
    position: absolute;
    inset: -20px;
    background: radial-gradient(circle, var(--hub-gold-glow) 0%, transparent 70%);
    border-radius: 50%;
    opacity: 0;
    transition: opacity var(--duration-slow) var(--ease-out-expo);
  }

  .ingredient-card:hover .ingredient-card__image-glow {
    opacity: 1;
  }

  .ingredient-card__image {
    position: relative;
    width: 100%;
    height: 100%;
    object-fit: cover;
    border-radius: 50%;
    box-shadow:
      0 8px 32px rgba(28, 25, 23, 0.15),
      0 2px 8px rgba(28, 25, 23, 0.1);
    transition: transform var(--duration-normal) var(--ease-out-back);
  }

  .ingredient-card:hover .ingredient-card__image {
    transform: scale(1.05) translateY(-4px);
  }

  .ingredient-card__identity {
    position: relative;
  }

  .ingredient-card__name {
    font-family: var(--font-display);
    font-size: 1.75rem;
    font-weight: 500;
    letter-spacing: -0.01em;
    color: var(--hub-black);
    margin: 0 0 var(--space-xs);
  }

  .ingredient-card__tagline {
    font-family: var(--font-body);
    font-size: 0.875rem;
    font-weight: 400;
    color: var(--hub-gold);
    letter-spacing: 0.1em;
    text-transform: uppercase;
    margin: 0;
  }

  /* ============================================
     TAB NAVIGATION - Elegant Underline
     ============================================ */

  .ingredient-card__tabs {
    position: relative;
    display: flex;
    border-top: 1px solid var(--hub-border);
    border-bottom: 1px solid var(--hub-border);
    background: rgba(250, 250, 249, 0.5);
  }

  .ingredient-card__tab {
    flex: 1;
    position: relative;
    padding: var(--space-md) var(--space-xs);
    font-family: var(--font-body);
    font-size: 0.8125rem;
    font-weight: 500;
    letter-spacing: 0.02em;
    color: var(--hub-stone-light);
    background: transparent;
    border: none;
    cursor: pointer;
    transition: color var(--duration-fast) ease;
    -webkit-tap-highlight-color: transparent;
  }

  .ingredient-card__tab:hover {
    color: var(--hub-black);
  }

  .ingredient-card__tab.is-active {
    color: var(--hub-black);
  }

  .ingredient-card__tab-text {
    position: relative;
    z-index: 1;
  }

  .ingredient-card__tab-indicator {
    position: absolute;
    bottom: -1px;
    left: 0;
    width: calc(100% / 3);
    height: 2px;
    background: var(--hub-gold);
    transition: transform var(--duration-normal) var(--ease-out-expo);
  }

  .ingredient-card__tab:nth-child(1).is-active ~ .ingredient-card__tab-indicator { transform: translateX(0); }
  .ingredient-card__tab:nth-child(2).is-active ~ .ingredient-card__tab-indicator { transform: translateX(100%); }
  .ingredient-card__tab:nth-child(3).is-active ~ .ingredient-card__tab-indicator { transform: translateX(200%); }

  .ingredient-card__tab:focus-visible {
    outline: 2px solid var(--hub-gold);
    outline-offset: -2px;
    border-radius: 2px;
  }

  /* ============================================
     TAB CONTENT
     ============================================ */

  .ingredient-card__content {
    padding: var(--space-lg);
    min-height: 200px;
  }

  .tab-panel {
    display: none;
    animation: fadeSlideIn var(--duration-normal) var(--ease-out-expo);
  }

  .tab-panel.is-active {
    display: block;
  }

  @keyframes fadeSlideIn {
    from {
      opacity: 0;
      transform: translateY(8px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* ============================================
     BENEFITS LIST
     ============================================ */

  .benefits-list {
    list-style: none;
    margin: 0;
    padding: 0;
    display: flex;
    flex-direction: column;
    gap: var(--space-sm);
  }

  .benefit-item {
    display: flex;
    align-items: flex-start;
    gap: var(--space-sm);
    opacity: 0;
    animation: benefitReveal var(--duration-normal) var(--ease-out-expo) forwards;
    animation-delay: var(--delay, 0s);
  }

  @keyframes benefitReveal {
    from {
      opacity: 0;
      transform: translateX(-12px);
    }
    to {
      opacity: 1;
      transform: translateX(0);
    }
  }

  .benefit-item__marker {
    flex-shrink: 0;
    width: 6px;
    height: 6px;
    margin-top: 8px;
    border-radius: 50%;
    background: var(--hub-gold);
  }

  .benefit-item__text {
    font-size: 0.9375rem;
    line-height: 1.6;
    color: var(--hub-black-soft);
  }

  /* ============================================
     ARTICLES LIST
     ============================================ */

  .articles-list {
    display: flex;
    flex-direction: column;
    gap: var(--space-sm);
  }

  .article-card {
    display: flex;
    align-items: center;
    gap: var(--space-md);
    padding: var(--space-md);
    background: var(--hub-white);
    border-radius: 12px;
    border: 1px solid var(--hub-border);
    text-decoration: none;
    color: inherit;
    cursor: pointer;
    opacity: 0;
    animation: articleReveal var(--duration-normal) var(--ease-out-expo) forwards;
    animation-delay: var(--delay, 0s);
    transition:
      background-color var(--duration-fast) ease,
      border-color var(--duration-fast) ease,
      transform var(--duration-fast) ease;
  }

  @keyframes articleReveal {
    from {
      opacity: 0;
      transform: translateY(12px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .article-card:hover {
    background: var(--hub-cream);
    border-color: var(--hub-gold);
    transform: translateX(4px);
  }

  .article-card:focus-visible {
    outline: 2px solid var(--hub-gold);
    outline-offset: 2px;
  }

  .article-card__body {
    flex: 1;
    min-width: 0;
  }

  .article-card__title {
    font-family: var(--font-body);
    font-size: 0.875rem;
    font-weight: 500;
    color: var(--hub-black);
    margin: 0 0 2px;
    line-height: 1.4;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .article-card__source {
    font-size: 0.75rem;
    color: var(--hub-stone-light);
    font-weight: 400;
  }

  .article-card__arrow {
    flex-shrink: 0;
    color: var(--hub-stone-light);
    transition:
      color var(--duration-fast) ease,
      transform var(--duration-fast) ease;
  }

  .article-card:hover .article-card__arrow {
    color: var(--hub-gold);
    transform: translate(2px, -2px);
  }

  .empty-state {
    font-family: var(--font-body);
    font-size: 0.875rem;
    color: var(--hub-stone-light);
    text-align: center;
    padding: var(--space-xl);
    font-style: italic;
  }

  /* ============================================
     TEST RESULTS
     ============================================ */

  .test-results {
    display: flex;
    flex-direction: column;
    gap: var(--space-md);
  }

  .test-item {
    opacity: 0;
    animation: testReveal var(--duration-normal) var(--ease-out-expo) forwards;
    animation-delay: var(--delay, 0s);
  }

  @keyframes testReveal {
    from {
      opacity: 0;
      transform: scale(0.96);
    }
    to {
      opacity: 1;
      transform: scale(1);
    }
  }

  .test-item__header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: var(--space-xs);
  }

  .test-item__name {
    font-size: 0.8125rem;
    font-weight: 500;
    color: var(--hub-black);
    text-transform: uppercase;
    letter-spacing: 0.03em;
  }

  .test-item__badge {
    display: inline-flex;
    align-items: center;
    gap: 4px;
    padding: 2px 8px;
    font-size: 0.6875rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    border-radius: 4px;
    background: var(--hub-border);
    color: var(--hub-stone);
  }

  .test-item__badge--pass {
    background: var(--hub-success-light);
    color: var(--hub-success);
  }

  .test-item__bar {
    height: 4px;
    background: var(--hub-border);
    border-radius: 2px;
    overflow: hidden;
    margin-bottom: var(--space-xs);
  }

  .test-item__progress {
    height: 100%;
    width: var(--progress, 100%);
    background: linear-gradient(90deg, var(--hub-gold) 0%, #E9A80C 100%);
    border-radius: 2px;
    transform: scaleX(0);
    transform-origin: left;
    animation: progressFill var(--duration-slow) var(--ease-out-expo) forwards;
    animation-delay: calc(var(--delay, 0s) + 0.2s);
  }

  @keyframes progressFill {
    to {
      transform: scaleX(1);
    }
  }

  .test-item__footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .test-item__percent {
    font-size: 0.75rem;
    font-weight: 600;
    color: var(--hub-gold);
    font-variant-numeric: tabular-nums;
  }

  .test-item__range {
    font-size: 0.6875rem;
    color: var(--hub-stone-light);
  }

  .test-footer {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-md);
    padding-top: var(--space-md);
    border-top: 1px solid var(--hub-border);
    margin-top: var(--space-xs);
  }

  .test-footer__item {
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 0.75rem;
    color: var(--hub-stone);
  }

  .test-footer__item svg {
    color: var(--hub-gold);
  }

  /* ============================================
     CARD FOOTER
     ============================================ */

  .ingredient-card__footer {
    padding: var(--space-sm) var(--space-lg);
    background: rgba(28, 25, 23, 0.02);
    border-top: 1px solid var(--hub-border-subtle);
    text-align: center;
  }

  .ingredient-card__note {
    font-size: 0.6875rem;
    color: var(--hub-stone-light);
    letter-spacing: 0.02em;
  }

  /* ============================================
     CAROUSEL DOTS
     ============================================ */

  .carousel-dots {
    display: none;
    justify-content: center;
    align-items: center;
    gap: 10px;
    padding: var(--space-lg) 0;
  }

  @media (max-width: 767px) {
    .carousel-dots {
      display: flex;
    }
  }

  .carousel-dot {
    width: 8px;
    height: 8px;
    border-radius: 4px;
    border: none;
    background: var(--hub-border);
    cursor: pointer;
    transition:
      background-color var(--duration-normal) ease,
      width var(--duration-normal) var(--ease-out-expo);
    padding: 0;
    position: relative;
    -webkit-tap-highlight-color: transparent;
  }

  .carousel-dot::before {
    content: '';
    position: absolute;
    inset: -18px;
  }

  .carousel-dot:hover {
    background: var(--hub-stone-light);
  }

  .carousel-dot:focus-visible {
    outline: 2px solid var(--hub-gold);
    outline-offset: 4px;
  }

  .carousel-dot.is-active {
    width: 28px;
    background: var(--hub-gold);
  }

  /* ============================================
     EMPTY STATE
     ============================================ */

  .ingredient-hub__empty {
    text-align: center;
    padding: var(--space-2xl);
    color: var(--hub-stone-light);
  }

  /* ============================================
     UTILITY
     ============================================ */

  .visually-hidden {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border: 0;
  }

  /* ============================================
     REDUCED MOTION
     ============================================ */

  @media (prefers-reduced-motion: reduce) {
    .ingredient-card,
    .ingredient-card__image,
    .ingredient-card__image-glow,
    .tab-panel,
    .benefit-item,
    .article-card,
    .test-item,
    .test-item__progress,
    .carousel-dot,
    .ingredient-card__tab-indicator {
      animation: none !important;
      transition: none !important;
    }

    .benefit-item,
    .article-card,
    .test-item {
      opacity: 1 !important;
      transform: none !important;
    }

    .test-item__progress {
      transform: scaleX(1) !important;
    }
  }
</style>

<script>
(function() {
  const section = document.getElementById('ingredient-hub-{{ section.id }}');
  if (!section) return;

  // Tab Switching with Indicator Animation
  const tabs = section.querySelectorAll('.ingredient-card__tab');

  function activateTab(tab) {
    const cardId = tab.dataset.card;
    const tabName = tab.dataset.tab;
    const tablist = tab.closest('.ingredient-card__tabs');
    const indicator = tablist.querySelector('.ingredient-card__tab-indicator');

    // Update tab states
    section.querySelectorAll(`.ingredient-card__tab[data-card="${cardId}"]`).forEach((t, i) => {
      const isActive = t.dataset.tab === tabName;
      t.classList.toggle('is-active', isActive);
      t.setAttribute('aria-selected', isActive ? 'true' : 'false');
      t.setAttribute('tabindex', isActive ? '0' : '-1');
    });

    // Animate indicator
    const tabIndex = Array.from(tablist.querySelectorAll('.ingredient-card__tab')).indexOf(tab);
    if (indicator) {
      indicator.style.transform = `translateX(${tabIndex * 100}%)`;
    }

    // Update panels
    section.querySelectorAll(`.tab-panel[data-card="${cardId}"]`).forEach(p => {
      const isActive = p.dataset.panel === tabName;
      p.classList.toggle('is-active', isActive);

      if (isActive) {
        // Re-trigger staggered animations
        const items = p.querySelectorAll('[style*="--delay"]');
        items.forEach(item => {
          item.style.animation = 'none';
          item.offsetHeight;
          item.style.animation = '';
        });
      }
    });
  }

  tabs.forEach(tab => {
    tab.addEventListener('click', () => activateTab(tab));

    // Keyboard navigation
    tab.addEventListener('keydown', function(e) {
      const tablist = this.closest('.ingredient-card__tabs');
      const cardTabs = Array.from(tablist.querySelectorAll('.ingredient-card__tab'));
      const currentIndex = cardTabs.indexOf(this);
      let newIndex;

      switch (e.key) {
        case 'ArrowRight':
        case 'ArrowDown':
          e.preventDefault();
          newIndex = (currentIndex + 1) % cardTabs.length;
          cardTabs[newIndex].focus();
          activateTab(cardTabs[newIndex]);
          break;
        case 'ArrowLeft':
        case 'ArrowUp':
          e.preventDefault();
          newIndex = (currentIndex - 1 + cardTabs.length) % cardTabs.length;
          cardTabs[newIndex].focus();
          activateTab(cardTabs[newIndex]);
          break;
        case 'Home':
          e.preventDefault();
          cardTabs[0].focus();
          activateTab(cardTabs[0]);
          break;
        case 'End':
          e.preventDefault();
          cardTabs[cardTabs.length - 1].focus();
          activateTab(cardTabs[cardTabs.length - 1]);
          break;
      }
    });
  });

  // Initialize tab states
  section.querySelectorAll('.ingredient-card__tabs').forEach(tablist => {
    tablist.querySelectorAll('.ingredient-card__tab').forEach(tab => {
      tab.setAttribute('tabindex', tab.classList.contains('is-active') ? '0' : '-1');
    });
  });

  // Mobile Infinite Carousel
  const carousel = section.querySelector('.ingredient-hub__carousel');
  const dots = section.querySelectorAll('.carousel-dot');
  const originalCards = Array.from(section.querySelectorAll('.ingredient-card:not(.is-clone)'));
  const cardCount = originalCards.length;
  const mobileQuery = window.matchMedia('(max-width: 767px)');

  if (carousel && cardCount > 1 && mobileQuery.matches) {
    const gap = 16;
    let cardWidth = 300 + gap;

    function setupInfiniteCarousel() {
      carousel.querySelectorAll('.is-clone').forEach(c => c.remove());

      originalCards.forEach((card, i) => {
        const cloneBefore = card.cloneNode(true);
        const cloneAfter = card.cloneNode(true);
        cloneBefore.classList.add('is-clone');
        cloneAfter.classList.add('is-clone');
        cloneBefore.setAttribute('data-clone-of', i);
        cloneAfter.setAttribute('data-clone-of', i);
        carousel.insertBefore(cloneBefore, carousel.firstChild);
        carousel.appendChild(cloneAfter);
      });

      setTimeout(() => {
        carousel.scrollLeft = cardCount * cardWidth;
      }, 10);
    }

    let isJumping = false;
    let scrollTimeout;

    function handleScroll() {
      if (isJumping) return;

      clearTimeout(scrollTimeout);
      scrollTimeout = setTimeout(() => {
        const scrollLeft = carousel.scrollLeft;
        const totalOriginalWidth = cardCount * cardWidth;

        let realIndex = Math.round((scrollLeft - totalOriginalWidth) / cardWidth);
        realIndex = ((realIndex % cardCount) + cardCount) % cardCount;

        dots.forEach((dot, i) => {
          dot.classList.toggle('is-active', i === realIndex);
        });

        if (scrollLeft <= cardWidth * 0.5) {
          isJumping = true;
          carousel.style.scrollBehavior = 'auto';
          carousel.scrollLeft = scrollLeft + totalOriginalWidth;
          carousel.style.scrollBehavior = '';
          setTimeout(() => { isJumping = false; }, 50);
        } else if (scrollLeft >= (cardCount * 2 - 0.5) * cardWidth + totalOriginalWidth) {
          isJumping = true;
          carousel.style.scrollBehavior = 'auto';
          carousel.scrollLeft = scrollLeft - totalOriginalWidth;
          carousel.style.scrollBehavior = '';
          setTimeout(() => { isJumping = false; }, 50);
        }
      }, 100);
    }

    carousel.addEventListener('scroll', handleScroll, { passive: true });

    dots.forEach((dot, index) => {
      dot.addEventListener('click', function() {
        carousel.scrollTo({
          left: (cardCount + index) * cardWidth,
          behavior: 'smooth'
        });
      });
    });

    setupInfiniteCarousel();

    let resizeTimeout;
    window.addEventListener('resize', () => {
      clearTimeout(resizeTimeout);
      resizeTimeout = setTimeout(() => {
        if (mobileQuery.matches) {
          setupInfiniteCarousel();
        }
      }, 250);
    });
  } else if (carousel && dots.length > 0) {
    let scrollTimeout;
    carousel.addEventListener('scroll', function() {
      clearTimeout(scrollTimeout);
      scrollTimeout = setTimeout(() => {
        const cards = section.querySelectorAll('.ingredient-card:not(.is-clone)');
        if (cards.length === 0) return;
        const cardWidth = cards[0].offsetWidth + 16;
        const scrollLeft = carousel.scrollLeft;
        const index = Math.round(scrollLeft / cardWidth);

        dots.forEach((dot, i) => {
          dot.classList.toggle('is-active', i === index);
        });
      }, 50);
    }, { passive: true });

    dots.forEach((dot, index) => {
      dot.addEventListener('click', function() {
        const cards = section.querySelectorAll('.ingredient-card:not(.is-clone)');
        if (cards.length === 0) return;
        const cardWidth = cards[0].offsetWidth + 16;
        carousel.scrollTo({
          left: index * cardWidth,
          behavior: 'smooth'
        });
      });
    });
  }

  // Progress bar animation on visibility
  const testPanels = section.querySelectorAll('.tab-panel[data-panel="tests"]');
  const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        entry.target.querySelectorAll('.test-item__progress').forEach(bar => {
          bar.style.animation = 'none';
          bar.offsetHeight;
          bar.style.animation = '';
        });
      }
    });
  }, { threshold: 0.5 });

  testPanels.forEach(panel => observer.observe(panel));
})();
</script>

{% schema %}
{
  "name": "Ingredient Science Hub",
  "tag": "section",
  "class": "section-ingredient-hub",
  "settings": [
    {
      "type": "text",
      "id": "title",
      "label": "Başlık",
      "default": "İçeriklerimizi Keşfedin"
    },
    {
      "type": "text",
      "id": "subtitle",
      "label": "Alt Başlık",
      "default": "Bilim destekli, şeffaf formül"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Arka Plan Rengi",
      "default": "#FAFAF9"
    },
    {
      "type": "range",
      "id": "padding_top",
      "label": "Üst Boşluk",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "default": 80
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "label": "Alt Boşluk",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "default": 80
    }
  ],
  "blocks": [
    {
      "type": "ingredient",
      "name": "İçerik",
      "settings": [
        {
          "type": "header",
          "content": "Temel Bilgiler"
        },
        {
          "type": "image_picker",
          "id": "image",
          "label": "İçerik Görseli"
        },
        {
          "type": "text",
          "id": "name",
          "label": "İçerik Adı",
          "default": "Rhodiola Rosea"
        },
        {
          "type": "text",
          "id": "tagline",
          "label": "Slogan",
          "default": "Stres Kalkanı"
        },
        {
          "type": "header",
          "content": "Faydalar Sekmesi"
        },
        {
          "type": "textarea",
          "id": "benefits",
          "label": "Faydalar",
          "info": "Her satıra bir fayda yazın",
          "default": "Bağışıklık sistemini güçlendirir\nEnerji seviyelerini artırır\nStres ve kaygıyı azaltır\nZihinsel odaklanmayı destekler"
        },
        {
          "type": "header",
          "content": "Makaleler Sekmesi"
        },
        {
          "type": "textarea",
          "id": "articles",
          "label": "Bilimsel Makaleler",
          "info": "Format: Başlık|Kaynak|URL (her satıra bir makale)",
          "default": "Rhodiola rosea adaptogenic effects on stress|PubMed|https://pubmed.ncbi.nlm.nih.gov/\nClinical efficacy of Rhodiola|Journal of Ethnopharmacology|https://www.sciencedirect.com/"
        },
        {
          "type": "header",
          "content": "Test Sonuçları Sekmesi"
        },
        {
          "type": "textarea",
          "id": "test_results",
          "label": "Test Sonuçları",
          "info": "Format: Test Adı|Sonuç|Yüzde|Kabul Aralığı (her satıra bir test). Örnek: Ağır Metal Testi|GEÇTİ|100|< 0.1 ppm",
          "default": "Ağır Metal Testi|GEÇTİ|100|< 0.1 ppm\nMikrobiyolojik Test|GEÇTİ|100|< 10 CFU/g\nSaflık Analizi|GEÇTİ|99.2|> 98%\nPestisit Testi|GEÇTİ|100|Tespit Edilmedi"
        },
        {
          "type": "text",
          "id": "certification",
          "label": "Sertifika",
          "default": "ISO 22000"
        },
        {
          "type": "text",
          "id": "test_date",
          "label": "Test Tarihi",
          "default": "Ocak 2024"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Ingredient Science Hub",
      "blocks": [
        {
          "type": "ingredient",
          "settings": {
            "name": "Rhodiola Rosea",
            "tagline": "Stres Kalkanı",
            "benefits": "Bağışıklık sistemini güçlendirir\nEnerji seviyelerini artırır\nStres ve kaygıyı azaltır\nZihinsel odaklanmayı destekler",
            "articles": "Rhodiola rosea adaptogenic effects|PubMed|https://pubmed.ncbi.nlm.nih.gov/\nClinical efficacy study|Journal of Ethnopharmacology|https://www.sciencedirect.com/",
            "test_results": "Ağır Metal Testi|GEÇTİ|100|< 0.1 ppm\nMikrobiyolojik Test|GEÇTİ|100|< 10 CFU/g\nSaflık Analizi|GEÇTİ|99.2|> 98%\nPestisit Testi|GEÇTİ|100|Tespit Edilmedi",
            "certification": "ISO 22000",
            "test_date": "Ocak 2024"
          }
        },
        {
          "type": "ingredient",
          "settings": {
            "name": "Ashwagandha",
            "tagline": "Adaptojenik Güç",
            "benefits": "Kortizol seviyelerini dengeler\nUyku kalitesini artırır\nKas gücünü destekler\nBilişsel fonksiyonları iyileştirir",
            "articles": "Ashwagandha for anxiety and stress|PubMed|https://pubmed.ncbi.nlm.nih.gov/\nWithanolides biological activity|Phytomedicine|https://www.sciencedirect.com/",
            "test_results": "Ağır Metal Testi|GEÇTİ|100|< 0.1 ppm\nMikrobiyolojik Test|GEÇTİ|100|< 10 CFU/g\nSaflık Analizi|GEÇTİ|98.5|> 98%\nPestisit Testi|GEÇTİ|100|Tespit Edilmedi",
            "certification": "GMP Sertifikalı",
            "test_date": "Aralık 2023"
          }
        },
        {
          "type": "ingredient",
          "settings": {
            "name": "Reishi",
            "tagline": "Ölümsüzlük Mantarı",
            "benefits": "Bağışıklık sistemini destekler\nUyku kalitesini artırır\nStres direncini güçlendirir\nAntioksidan koruma sağlar",
            "articles": "Ganoderma lucidum immunomodulatory effects|PubMed|https://pubmed.ncbi.nlm.nih.gov/\nReishi mushroom benefits|Frontiers in Pharmacology|https://www.frontiersin.org/",
            "test_results": "Ağır Metal Testi|GEÇTİ|100|< 0.1 ppm\nMikrobiyolojik Test|GEÇTİ|100|< 10 CFU/g\nSaflık Analizi|GEÇTİ|97.8|> 98%\nPestisit Testi|GEÇTİ|100|Tespit Edilmedi",
            "certification": "Organik Sertifikalı",
            "test_date": "Kasım 2023"
          }
        }
      ]
    }
  ]
}
{% endschema %}
